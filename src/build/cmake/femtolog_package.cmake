# Copyright 2025 pugur
# This source code is licensed under the Apache License, Version 2.0
# which can be found in the LICENSE file.

function(femtolog_setup_package)
  include(InstallRequiredSystemLibraries)
  set(CPACK_PACKAGE_NAME "${MAIN_LIB_NAME}")
  set(CPACK_PACKAGE_VENDOR "${PROJECT_AUTHOR}")
  set(CPACK_PACKAGE_CONTACT "${PROJECT_AUTHOR_CONTACT}")
  set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${CMAKE_PROJECT_DESCRIPTION}")
  set(CPACK_PACKAGE_VERSION "${CMAKE_PROJECT_VERSION}")

  set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}-${lower_build_type}_${TARGET_OS_NAME}_${TARGET_ARCH}")
  set(CPACK_RESOURCE_FILE_LICENSE "${PROJECT_ROOT_DIR}/LICENSE")
  set(CPACK_RESOURCE_FILE_README "${PROJECT_ROOT_DIR}/README.md")
  # set(CPACK_PACKAGE_DIRECTORY "${PROJECT_OUT_DIR}/package")
  set(CPACK_PACKAGE_DIRECTORY "${PROJECT_OUT_DIR}/package/${lower_build_type}-${TARGET_OS_NAME}-${TARGET_ARCH}")
  set(CPACK_PACKAGE_INSTALL_DIRECTORY "${MAIN_LIB_NAME}")
  set(CPACK_PACKAGE_INSTALL_REGISTRY_KEY "${CPACK_PACKAGE_NAME}_${CPACK_PACKAGE_VERSION}")

  if(TARGET_OS_NAME MATCHES "linux")
    set(CPACK_GENERATOR "TGZ")
    set(CPACK_DEBIAN_PACKAGE_MAINTAINER "${CPACK_PACKAGE_VENDOR}")
    set(CPACK_DEBIAN_PACKAGE_DEPENDS "libc6 (>= 2.27)")
    set(CPACK_DEBIAN_PACKAGE_SECTION "utils")
  elseif(TARGET_OS_NAME MATCHES "windows")
    set(CPACK_GENERATOR "ZIP")
  elseif(TARGET_OS_NAME MATCHES "darwin")
    set(CPACK_GENERATOR "TGZ")
  else()
    message(FATAL_ERROR "unknown platform detected: ${TARGET_OS_NAME}")
  endif()

  include(CPack)
endfunction()
